<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thyroid Ultrasound Report Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .report-section {
            transition: all 0.3s ease;
        }
        .report-section:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tirads-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        .nodule-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
        }
        .nodule-marker:hover {
            transform: translate(-50%, -50%) scale(1.5);
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-800 mb-2">Thyroid Ultrasound Report Generator</h1>
            <p class="text-gray-600">Create comprehensive thyroid ultrasound reports with TI-RADS scoring</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Input Form -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-blue-700 mb-4 border-b pb-2">Patient Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Patient Name</label>
                            <input type="text" id="patientName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Patient ID</label>
                            <input type="text" id="patientID" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Date of Birth</label>
                            <input type="date" id="patientDOB" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Exam Date</label>
                            <input type="date" id="examDate" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Thyroid Measurements -->
                <div class="mb-6 report-section bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-xl font-semibold text-blue-700 mb-4 border-b pb-2">Thyroid Lobes and Isthmus</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <h3 class="font-medium text-gray-700 mb-3">Right Lobe</h3>
                            <div class="space-y-2">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Length (cm)</label>
                                    <input type="number" step="0.1" id="rightLength" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Width (cm)</label>
                                    <input type="number" step="0.1" id="rightWidth" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Depth (cm)</label>
                                    <input type="number" step="0.1" id="rightDepth" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <h3 class="font-medium text-gray-700 mb-3">Left Lobe</h3>
                            <div class="space-y-2">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Length (cm)</label>
                                    <input type="number" step="0.1" id="leftLength" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Width (cm)</label>
                                    <input type="number" step="0.1" id="leftWidth" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Depth (cm)</label>
                                    <input type="number" step="0.1" id="leftDepth" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <h3 class="font-medium text-gray-700 mb-3">Isthmus</h3>
                            <div class="space-y-2">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Thickness (mm)</label>
                                    <input type="number" step="0.1" id="isthmusThickness" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm text-gray-600 mb-1">Echogenicity</label>
                                    <select id="echogenicity" class="w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                        <option value="homogeneous">Homogeneous</option>
                                        <option value="heterogeneous">Heterogeneous</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative h-48 bg-gray-100 rounded-lg overflow-hidden mt-4">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="relative w-3/4 h-3/4">
                                <!-- Thyroid outline -->
                                <svg viewBox="0 0 200 100" class="w-full h-full">
                                    <!-- Right lobe -->
                                    <path d="M50,50 Q70,20 90,50 Q70,80 50,50 Z" fill="rgba(59, 130, 246, 0.2)" stroke="#3B82F6" stroke-width="1" />
                                    <!-- Left lobe -->
                                    <path d="M110,50 Q130,20 150,50 Q130,80 110,50 Z" fill="rgba(59, 130, 246, 0.2)" stroke="#3B82F6" stroke-width="1" />
                                    <!-- Isthmus -->
                                    <rect x="90" y="45" width="10" height="10" fill="rgba(59, 130, 246, 0.2)" stroke="#3B82F6" stroke-width="1" />
                                    <text x="70" y="30" class="text-xs">Right Lobe</text>
                                    <text x="130" y="30" class="text-xs">Left Lobe</text>
                                    <text x="95" y="55" class="text-xs">Isthmus</text>
                                </svg>
                                <!-- Nodule markers will be added here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nodules Section -->
                <div class="mb-6 report-section bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-4 border-b pb-2">
                        <h2 class="text-xl font-semibold text-blue-700">Thyroid Nodules</h2>
                        <button id="addNoduleBtn" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 transition flex items-center">
                            <i class="fas fa-plus mr-1"></i> Add Nodule
                        </button>
                    </div>
                    
                    <div id="nodulesContainer" class="space-y-4">
                        <!-- Nodule entries will be added here -->
                    </div>
                </div>

                <!-- Lymph Nodes Section -->
                <div class="mb-6 report-section bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-xl font-semibold text-blue-700 mb-4 border-b pb-2">Lymph Nodes</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Presence of Abnormal Lymph Nodes</label>
                            <select id="lymphNodesPresent" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div id="lymphNodeDetailsContainer" class="hidden">
                            <label class="block text-gray-700 mb-2">Details</label>
                            <textarea id="lymphNodeDetails" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Location, size, characteristics..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Impression Section -->
                <div class="report-section bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-xl font-semibold text-blue-700 mb-4 border-b pb-2">Impression</h2>
                    <textarea id="impression" rows="4" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your clinical impression..."></textarea>
                </div>
            </div>

            <!-- Report Preview -->
            <div class="bg-white rounded-lg shadow-md p-6 h-fit sticky top-6">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h2 class="text-xl font-semibold text-blue-700">Report Preview</h2>
                    <button id="generateReportBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center">
                        <i class="fas fa-file-medical mr-2"></i> Generate Report
                    </button>
                </div>
                
                <div id="reportPreview" class="bg-gray-50 p-4 rounded-lg text-sm font-mono overflow-auto max-h-[80vh]">
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-file-alt text-4xl mb-2"></i>
                        <p>Your report will appear here</p>
                    </div>
                </div>
                
                <div id="tiradsScoreContainer" class="mt-4 hidden">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 mb-2">TI-RADS Score</h3>
                        <div id="tiradsScore" class="text-2xl font-bold text-center mb-2">0</div>
                        <div id="tiradsCategory" class="text-center font-medium mb-3">
                            <span class="tirads-badge bg-gray-200 text-gray-800">TR1</span>
                        </div>
                        <div id="tiradsRecommendation" class="text-sm text-gray-700">
                            No suspicious features. Routine follow-up not recommended.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nodule Template (hidden) -->
    <template id="noduleTemplate">
        <div class="nodule-entry bg-white p-4 rounded-lg shadow-sm fade-in">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-medium text-gray-700">Nodule <span class="nodule-number">1</span></h3>
                <button class="delete-nodule text-red-500 hover:text-red-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Location</label>
                    <select class="nodule-location w-full px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <option value="right">Right Lobe</option>
                        <option value="left">Left Lobe</option>
                        <option value="isthmus">Isthmus</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Size (cm)</label>
                    <div class="flex space-x-2">
                        <input type="number" step="0.1" placeholder="L" class="nodule-length w-1/3 px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <input type="number" step="0.1" placeholder="W" class="nodule-width w-1/3 px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <input type="number" step="0.1" placeholder="D" class="nodule-depth w-1/3 px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                </div>
            </div>
            
            <div class="mt-3">
                <label class="block text-sm text-gray-600 mb-1">ACR TI-RADS Descriptors</label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="checkbox" class="tirads-composition mr-2" value="composition">
                        <label class="text-sm">Composition (solid or almost completely solid)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" class="tirads-echogenicity mr-2" value="echogenicity">
                        <label class="text-sm">Echogenicity (markedly hypoechoic)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" class="tirads-shape mr-2" value="shape">
                        <label class="text-sm">Shape (taller-than-wide)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" class="tirads-margin mr-2" value="margin">
                        <label class="text-sm">Margin (irregular or lobulated)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" class="tirads-echogenicFoci mr-2" value="echogenicFoci">
                        <label class="text-sm">Echogenic foci (punctate echogenic foci)</label>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add nodule functionality
            const addNoduleBtn = document.getElementById('addNoduleBtn');
            const nodulesContainer = document.getElementById('nodulesContainer');
            const noduleTemplate = document.getElementById('noduleTemplate');
            let noduleCount = 0;
            
            addNoduleBtn.addEventListener('click', function() {
                noduleCount++;
                const noduleClone = noduleTemplate.content.cloneNode(true);
                const noduleEntry = noduleClone.querySelector('.nodule-entry');
                noduleEntry.querySelector('.nodule-number').textContent = noduleCount;
                
                // Add delete functionality
                const deleteBtn = noduleClone.querySelector('.delete-nodule');
                deleteBtn.addEventListener('click', function() {
                    noduleEntry.remove();
                    updateNoduleMarkers();
                });
                
                // Add to container
                nodulesContainer.appendChild(noduleClone);
                
                // Update nodule markers on thyroid diagram
                updateNoduleMarkers();
                
                // Scroll to the new nodule
                setTimeout(() => {
                    noduleEntry.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            });
            
            // Lymph nodes presence toggle
            const lymphNodesPresent = document.getElementById('lymphNodesPresent');
            const lymphNodeDetailsContainer = document.getElementById('lymphNodeDetailsContainer');
            
            lymphNodesPresent.addEventListener('change', function() {
                if (this.value === 'yes') {
                    lymphNodeDetailsContainer.classList.remove('hidden');
                } else {
                    lymphNodeDetailsContainer.classList.add('hidden');
                }
            });
            
            // Generate report button
            const generateReportBtn = document.getElementById('generateReportBtn');
            const reportPreview = document.getElementById('reportPreview');
            const tiradsScoreContainer = document.getElementById('tiradsScoreContainer');
            const tiradsScore = document.getElementById('tiradsScore');
            const tiradsCategory = document.getElementById('tiradsCategory');
            const tiradsRecommendation = document.getElementById('tiradsRecommendation');
            
            generateReportBtn.addEventListener('click', function() {
                // Get patient information
                const patientName = document.getElementById('patientName').value || 'Not provided';
                const patientID = document.getElementById('patientID').value || 'Not provided';
                const patientDOB = document.getElementById('patientDOB').value || 'Not provided';
                const examDate = document.getElementById('examDate').value || 'Not provided';
                
                // Get thyroid measurements
                const rightLobe = {
                    length: document.getElementById('rightLength').value || 'Not measured',
                    width: document.getElementById('rightWidth').value || 'Not measured',
                    depth: document.getElementById('rightDepth').value || 'Not measured'
                };
                
                const leftLobe = {
                    length: document.getElementById('leftLength').value || 'Not measured',
                    width: document.getElementById('leftWidth').value || 'Not measured',
                    depth: document.getElementById('leftDepth').value || 'Not measured'
                };
                
                const isthmusThickness = document.getElementById('isthmusThickness').value || 'Not measured';
                const echogenicity = document.getElementById('echogenicity').value;
                
                // Get nodules information
                const nodules = [];
                const noduleEntries = document.querySelectorAll('.nodule-entry');
                let totalTiradsScore = 0;
                
                noduleEntries.forEach((entry, index) => {
                    const location = entry.querySelector('.nodule-location').value;
                    const length = entry.querySelector('.nodule-length').value || 'Not measured';
                    const width = entry.querySelector('.nodule-width').value || 'Not measured';
                    const depth = entry.querySelector('.nodule-depth').value || 'Not measured';
                    
                    // Calculate TI-RADS score for this nodule
                    let noduleScore = 0;
                    const composition = entry.querySelector('.tirads-composition').checked ? 1 : 0;
                    const echogenicityChecked = entry.querySelector('.tirads-echogenicity').checked ? 1 : 0;
                    const shape = entry.querySelector('.tirads-shape').checked ? 1 : 0;
                    const margin = entry.querySelector('.tirads-margin').checked ? 1 : 0;
                    const echogenicFoci = entry.querySelector('.tirads-echogenicFoci').checked ? 1 : 0;
                    
                    noduleScore = composition + echogenicityChecked + shape + margin + echogenicFoci;
                    totalTiradsScore = Math.max(totalTiradsScore, noduleScore);
                    
                    nodules.push({
                        number: index + 1,
                        location,
                        size: `${length} × ${width} × ${depth} cm`,
                        tiradsScore: noduleScore
                    });
                });
                
                // Get lymph nodes information
                const lymphNodes = {
                    present: lymphNodesPresent.value === 'yes' ? 'Present' : 'Not present',
                    details: lymphNodesPresent.value === 'yes' ? document.getElementById('lymphNodeDetails').value : 'N/A'
                };
                
                // Get impression
                const impression = document.getElementById('impression').value || 'No specific impression provided.';
                
                // Generate report HTML
                let reportHTML = `
                    <div class="space-y-4">
                        <div class="text-center border-b pb-2 mb-4">
                            <h2 class="text-lg font-bold">THYROID ULTRASOUND REPORT</h2>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p><strong>Patient Name:</strong> ${patientName}</p>
                                <p><strong>Patient ID:</strong> ${patientID}</p>
                            </div>
                            <div>
                                <p><strong>Date of Birth:</strong> ${patientDOB}</p>
                                <p><strong>Exam Date:</strong> ${examDate}</p>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <h3 class="font-semibold mb-2">THYROID GLAND</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-2">
                                <div>
                                    <p><strong>Right Lobe:</strong> ${rightLobe.length} × ${rightLobe.width} × ${rightLobe.depth} cm</p>
                                </div>
                                <div>
                                    <p><strong>Left Lobe:</strong> ${leftLobe.length} × ${leftLobe.width} × ${leftLobe.depth} cm</p>
                                </div>
                            </div>
                            <p><strong>Isthmus Thickness:</strong> ${isthmusThickness} mm</p>
                            <p><strong>Echogenicity:</strong> ${echogenicity === 'homogeneous' ? 'Homogeneous' : 'Heterogeneous'}</p>
                        </div>
                `;
                
                // Add nodules section if present
                if (nodules.length > 0) {
                    reportHTML += `
                        <div class="border-t pt-4">
                            <h3 class="font-semibold mb-2">THYROID NODULES</h3>
                            <p>${nodules.length} nodule(s) identified:</p>
                            <div class="mt-2 space-y-3">
                    `;
                    
                    nodules.forEach(nodule => {
                        reportHTML += `
                            <div class="pl-4 border-l-2 border-blue-200">
                                <p><strong>Nodule ${nodule.number}:</strong> Located in the ${nodule.location} lobe</p>
                                <p><strong>Size:</strong> ${nodule.size}</p>
                                <p><strong>TI-RADS Points:</strong> ${nodule.tiradsScore}</p>
                            </div>
                        `;
                    });
                    
                    reportHTML += `
                            </div>
                        </div>
                    `;
                } else {
                    reportHTML += `
                        <div class="border-t pt-4">
                            <h3 class="font-semibold mb-2">THYROID NODULES</h3>
                            <p>No thyroid nodules identified.</p>
                        </div>
                    `;
                }
                
                // Add lymph nodes section
                reportHTML += `
                    <div class="border-t pt-4">
                        <h3 class="font-semibold mb-2">LYMPH NODES</h3>
                        <p><strong>Presence:</strong> ${lymphNodes.present}</p>
                        <p><strong>Details:</strong> ${lymphNodes.details}</p>
                    </div>
                    
                    <div class="border-t pt-4">
                        <h3 class="font-semibold mb-2">IMPRESSION</h3>
                        <p>${impression}</p>
                    </div>
                    
                    <div class="border-t pt-4 text-xs text-gray-500">
                        <p>Report generated by Thyroid Ultrasound Report Generator on ${new Date().toLocaleDateString()}</p>
                    </div>
                `;
                
                reportHTML += `</div>`;
                
                // Update report preview
                reportPreview.innerHTML = reportHTML;
                
                // Update TI-RADS score and recommendations
                if (nodules.length > 0) {
                    tiradsScore.textContent = totalTiradsScore;
                    
                    let category = '';
                    let recommendation = '';
                    let badgeColor = '';
                    
                    if (totalTiradsScore === 0) {
                        category = 'TR1 (Benign)';
                        recommendation = 'No suspicious features. Routine follow-up not recommended.';
                        badgeColor = 'bg-green-200 text-green-800';
                    } else if (totalTiradsScore === 1) {
                        category = 'TR2 (Not suspicious)';
                        recommendation = 'Follow-up ultrasound in 5 years.';
                        badgeColor = 'bg-blue-200 text-blue-800';
                    } else if (totalTiradsScore === 2) {
                        category = 'TR3 (Mildly suspicious)';
                        recommendation = 'Follow-up ultrasound in 1-3 years.';
                        badgeColor = 'bg-yellow-200 text-yellow-800';
                    } else if (totalTiradsScore === 3) {
                        category = 'TR4 (Moderately suspicious)';
                        recommendation = 'Consider fine needle aspiration (FNA) if ≥1.5 cm. Follow-up if not FNA.';
                        badgeColor = 'bg-orange-200 text-orange-800';
                    } else {
                        category = 'TR5 (Highly suspicious)';
                        recommendation = 'FNA recommended if ≥1 cm. Surgical consultation if malignant.';
                        badgeColor = 'bg-red-200 text-red-800';
                    }
                    
                    tiradsCategory.innerHTML = `<span class="tirads-badge ${badgeColor}">${category}</span>`;
                    tiradsRecommendation.textContent = recommendation;
                    tiradsScoreContainer.classList.remove('hidden');
                } else {
                    tiradsScoreContainer.classList.add('hidden');
                }
            });
            
            // Update nodule markers on thyroid diagram
            function updateNoduleMarkers() {
                // Clear existing markers
                const existingMarkers = document.querySelectorAll('.nodule-marker');
                existingMarkers.forEach(marker => marker.remove());
                
                // Get thyroid diagram container
                const thyroidDiagram = document.querySelector('.relative.w-3\\/4.h-3\\/4');
                
                // Add markers for each nodule
                const noduleEntries = document.querySelectorAll('.nodule-entry');
                noduleEntries.forEach((entry, index) => {
                    const location = entry.querySelector('.nodule-location').value;
                    
                    // Create marker element
                    const marker = document.createElement('div');
                    marker.className = 'nodule-marker bg-red-500 shadow-md';
                    marker.title = `Nodule ${index + 1}`;
                    
                    // Position marker based on location
                    let left, top;
                    const size = 12 + (index * 2); // Slightly larger for each subsequent nodule
                    
                    if (location === 'right') {
                        left = 30 + (Math.random() * 20); // Random position in right lobe
                        top = 40 + (Math.random() * 20);
                    } else if (location === 'left') {
                        left = 70 + (Math.random() * 20); // Random position in left lobe
                        top = 40 + (Math.random() * 20);
                    } else { // isthmus
                        left = 50;
                        top = 50;
                    }
                    
                    // Apply position (as percentage)
                    marker.style.left = `${left}%`;
                    marker.style.top = `${top}%`;
                    marker.style.width = `${size}px`;
                    marker.style.height = `${size}px`;
                    
                    // Add click handler to highlight corresponding nodule entry
                    marker.addEventListener('click', function() {
                        entry.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        entry.classList.add('ring-2', 'ring-blue-500');
                        setTimeout(() => {
                            entry.classList.remove('ring-2', 'ring-blue-500');
                        }, 2000);
                    });
                    
                    // Add to diagram
                    thyroidDiagram.appendChild(marker);
                });
            }
            
            // Initialize with one nodule
            addNoduleBtn.click();
            
            // Set exam date to today by default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('examDate').value = today;
        });
    </script>
</body>
</html>